{"version":3,"file":"Options.js","sources":["../src/Options.js"],"sourcesContent":["/* eslint-disable no-return-assign */\r\n/* eslint-disable unicorn/no-array-reduce */\r\nimport { logger } from './utils/Logger.js'\r\nimport { vars } from './_variables.js'\r\n\r\nconst root = document.querySelector(':root')\r\n\r\nfunction getStyle(name) {\r\n  const select = (root !== undefined && root !== null) ? getComputedStyle(root) : null\r\n  if (select !== null) {\r\n    return select.getPropertyValue(name)\r\n  }\r\n\r\n  return null\r\n}\r\n\r\nfunction returnNumbersOnly(string) {\r\n  let output = ''\r\n  for (const s of string) {\r\n    if (!Number.isNaN(s) || s === '.') {\r\n      output += s\r\n    } else {\r\n      break\r\n    }\r\n  }\r\n\r\n  return Number(output)\r\n}\r\n\r\nfunction getCssRoot() {\r\n  const cssVars = Array.from(document.styleSheets)\r\n    .filter(\r\n      sheet =>\r\n        sheet.href === null || sheet.href.startsWith(window.location.origin)\r\n    )\r\n    .reduce(\r\n      (acc, sheet) =>\r\n        (acc = [\r\n          ...acc,\r\n          ...Array.from(sheet.cssRules).reduce(\r\n            (def, rule) =>\r\n              (def =\r\n                rule.selectorText === ':root' ?\r\n                  [\r\n                    ...def,\r\n                    ...Array.from(rule.style).filter(name =>\r\n                      name.startsWith('--')\r\n                    )\r\n                  ] :\r\n                  def),\r\n            []\r\n          )\r\n        ]),\r\n      []\r\n    )\r\n  return cssVars\r\n}\r\n\r\nclass Options {\r\n  importVariablesFromCss() {\r\n    const root = getCssRoot()\r\n    logger.log('the found root is: ', root)\r\n\r\n    const prefix = getStyle('--prefix')\r\n    vars.prefix = prefix\r\n\r\n    for (const element of root) {\r\n      const key = element.slice(2)\r\n      const val = getStyle(element)\r\n      let set = null\r\n\r\n      // skip if value is nulled or key is too long\r\n      if (val.length === 0 || key.length > 30) {\r\n        continue\r\n      }\r\n\r\n      // skip the prefix\r\n      if (key === 'prefix') {\r\n        continue\r\n      }\r\n\r\n      // skip the vh100 and vw100 values, which we only need to set not get\r\n      if (key === `${prefix}vh100` || key === `${prefix}vw100`) {\r\n        continue\r\n      }\r\n\r\n      // skip the spacer, set that later\r\n      if (key === `${prefix}spacer`) {\r\n        continue\r\n      }\r\n\r\n      // skip if prefix is not detected, for the rest of the rooted variables\r\n      if (!key.includes(prefix)) {\r\n        continue\r\n      }\r\n\r\n      // set the value to a number if first digit is a number, otherwise set it as a string\r\n      set = Number.isNaN(val[0]) ? val : returnNumbersOnly(val)\r\n\r\n      vars[`${key.slice(prefix.length)}`] = set\r\n    }\r\n\r\n    // set the spacer as a result of the rem times the base px value of the font size\r\n    const spacer = returnNumbersOnly(getStyle(`--${prefix}spacer`)) * returnNumbersOnly(window.getComputedStyle(document.body).fontSize)\r\n    vars.spacer = spacer\r\n\r\n    logger.log('The vars are now: ', vars)\r\n    document.removeEventListener('DOMContentLoaded', options.importVariablesFromCss)\r\n  }\r\n\r\n  dev() {\r\n    vars.dev = true\r\n    logger.log('set dev mode to true')\r\n  }\r\n\r\n  normalize(value){\r\n    if(value === 'true'){\r\n      return true\r\n    }\r\n    if (value === 'false'){\r\n      return false\r\n    }\r\n    if( value === '' || value === 'null' || !value || value === undefined){\r\n       return null\r\n    }\r\n    if (value === Number(value).toString()){\r\n      return Number(value)\r\n    }\r\n    if (typeof value !== 'string'){\r\n      return value\r\n    }\r\n    try {\r\n      return JSON.parse(decodeURIComponent(value))\r\n    } catch {\r\n      return value\r\n    }\r\n  }\r\n}\r\nexport const options = new Options()\r\ndocument.addEventListener('DOMContentLoaded', options.importVariablesFromCss)\r\n"],"names":["root","document","querySelector","getStyle","name","select","undefined","getComputedStyle","getPropertyValue","returnNumbersOnly","string","output","s","Number","isNaN","getCssRoot","cssVars","Array","from","styleSheets","filter","sheet","href","startsWith","window","location","origin","reduce","acc","cssRules","def","rule","selectorText","style","Options","importVariablesFromCss","logger","log","prefix","vars","element","key","slice","val","set","length","includes","spacer","body","fontSize","removeEventListener","options","dev","normalize","value","toString","JSON","parse","decodeURIComponent","addEventListener"],"mappings":"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"}