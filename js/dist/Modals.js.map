{"version":3,"file":"Modals.js","sources":["../src/Modals.js"],"sourcesContent":["import { vars } from './_variables.js'\r\nimport { logger } from './utils/Logger.js'\r\nimport { Modal } from './models/Modal.js'\r\n\r\nlet targetModalId = null\r\nlet targetModal = null\r\nlet modalOptions = {}\r\nlet modalClosing = false\r\nlet modalOpening = false\r\n\r\nfunction setFocus() {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  // Check to see if an element has the autofocus attribute applied,\r\n  // and if not apply it to the first child of the element.\r\n  let autofocus = 0\r\n  Array.prototype.forEach.call(targetModal.querySelectorAll('[autofocus]'), () => {\r\n    autofocus++\r\n  })\r\n  if (autofocus == 0) {\r\n    logger.log('no autofocus target provided, setting first child to autofocus.')\r\n    targetModal.firstChild.setAttribute('autofocus', '')\r\n  }\r\n}\r\n\r\nfunction awaitEscKeyCloseModal(e) {\r\n  // listen for the user to press escape key, then fire the code\r\n  // to close the modal\r\n  if (e.key === 'Escape' || e.keyCode === 27) {\r\n    logger.log('escape pressed')\r\n    closeModal()\r\n  }\r\n}\r\n\r\nfunction awaitOutClickCloseModal(e) {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  // if modal is closed it will not be visible on the dom\r\n  if (!targetModal.checkVisibility()) {\r\n    return\r\n  }\r\n\r\n  const rect = targetModal.getBoundingClientRect()\r\n  if (e.x < rect.left || e.x > (rect.width + rect.left)) {\r\n    closeModal()\r\n  } else if (e.y < rect.top || e.y > (rect.height + rect.top)) {\r\n    closeModal()\r\n  }\r\n}\r\n\r\nfunction awaitOutTouchStartToCloseModal(e) {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  const x = e.changedTouches[0].clientX\r\n  const y = e.changedTouches[0].clientY\r\n  const rect = targetModal.getBoundingClientRect()\r\n  // // if modal is closed it will not be visible on the dom\r\n  // // so return\r\n  // if(!modal.checkVisibility()){ return }\r\n\r\n  if (x < rect.left + window.scrollX || x > rect.left + window.scrollX + rect.width) {\r\n    // further left\r\n    targetModal.addEventListener('touchend', awaitOutTouchEndToCloseModal)\r\n  } else if (y < rect.top + window.scrollY || y > rect.top + window.scrollY + rect.height) {\r\n    // above\r\n    targetModal.addEventListener('touchend', awaitOutTouchEndToCloseModal)\r\n  }\r\n}\r\n\r\nfunction awaitOutTouchEndToCloseModal(e) {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  const x = e.changedTouches[0].clientX\r\n  const y = e.changedTouches[0].clientY\r\n  const rect = targetModal.getBoundingClientRect()\r\n\r\n  targetModal.removeEventListener('touchend', awaitOutTouchEndToCloseModal)\r\n  // // if modal is closed it will not be visible on the dom\r\n  // // so return\r\n  // if(!modal.checkVisibility()){ return }\r\n\r\n  if (x < rect.left + window.scrollX || x > rect.left + window.scrollX + rect.width) {\r\n    closeModal()\r\n  } else if (y < rect.top + window.scrollY || y > rect.top + window.scrollY + rect.height) {\r\n    closeModal()\r\n  }\r\n}\r\n\r\nfunction getScrollBarWidth() {\r\n  const el = document.createElement('div')\r\n  el.style.cssText = 'overflow:scroll; visibility:hidden; position:absolute;'\r\n  document.body.append(el)\r\n  const width = el.offsetWidth - el.clientWidth\r\n  el.remove()\r\n  return width\r\n}\r\n\r\nfunction toggleScroll(toggle = true) {\r\n  if (toggle) {\r\n    // get the width of the scrollbar in the document\r\n    const scrollBarWidth = getScrollBarWidth()\r\n    // turn the body scroll off when modal is open\r\n    document.body.classList.add('modal-open')\r\n    // then set the padding of the body to be equal to that\r\n    document.body.style.paddingRight = `${scrollBarWidth}px`\r\n  } else {\r\n    // turn the body scroll off when modal is open\r\n    document.body.classList.remove('modal-open')\r\n    // then set the padding of the body to be equal to that\r\n    document.body.style = ''\r\n  }\r\n}\r\n\r\nfunction toggleEventListenersToCloseModal(toggle = true) {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  if (toggle) {\r\n    targetModal.addEventListener('cancel', e => {\r\n      e.preventDefault()\r\n    })\r\n    window.addEventListener('click', awaitOutClickCloseModal)\r\n    document.addEventListener('keydown', awaitEscKeyCloseModal)\r\n    window.addEventListener('touchstart', awaitOutTouchStartToCloseModal)\r\n  } else {\r\n    targetModal.removeEventListener('cancel', e => {\r\n      e.preventDefault()\r\n    })\r\n    window.removeEventListener('click', awaitOutClickCloseModal)\r\n    document.removeEventListener('keydown', awaitEscKeyCloseModal)\r\n    window.removeEventListener('touchstart', awaitOutTouchStartToCloseModal)\r\n  }\r\n}\r\n\r\nfunction toggleOptionsAndAttributes(toggle = true, options) {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  if (!options) {\r\n    options = new Modal(modalOptions)\r\n  }\r\n\r\n  if (toggle) {\r\n    if (options.centered) {\r\n      targetModal.setAttribute('data-centered', '')\r\n    }\r\n\r\n    if (options.static) {\r\n      targetModal.setAttribute('data-static', '')\r\n    }\r\n\r\n    if (options.scrollable) {\r\n      targetModal.setAttribute('data-scrollable', '')\r\n    }\r\n\r\n    if (!options.animation) {\r\n      targetModal.setAttribute('data-no-animation', '')\r\n    }\r\n  } else {\r\n    if (options.centered) {\r\n      targetModal.removeAttribute('data-centered', '')\r\n    }\r\n\r\n    if (options.static) {\r\n      targetModal.removeAttribute('data-static', '')\r\n    }\r\n\r\n    if (options.scrollable) {\r\n      targetModal.removeAttribute('data-scrollable', '')\r\n    }\r\n\r\n    if (!options.animation) {\r\n      targetModal.removeAttribute('data-no-animation', '')\r\n    }\r\n  }\r\n}\r\n\r\nfunction setModalValuesAndEnvironment(id, options) {\r\n  // sanitize the options from the user\r\n  // and save the options for use later\r\n  modalOptions = new Modal(options)\r\n  // set the variables id to check against\r\n  targetModalId = id\r\n  // get the element to manipulate\r\n  targetModal = document?.getElementById(targetModalId)\r\n}\r\n\r\nfunction resetModalValuesAndEnvironment() {\r\n  // reset the environment\r\n  targetModalId = null\r\n  targetModal = null\r\n}\r\n\r\nasync function openModal(id, options) {\r\n  // check to see if the environment is ready\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  // set the options, true to set, false to remove, options as second param\r\n  toggleOptionsAndAttributes(true)\r\n\r\n  // Make sure the modal has a focusable target before opening\r\n  setFocus()\r\n\r\n  // FIXME - the current solution for the callback is to have\r\n  // timeouts set, this makes for some shoddy code and adds in delays, this\r\n  // can probably be fixed, but for now I have settled on making it work first\r\n  // and if I find the better way of doing this later I'll update it.\r\n\r\n  // then start the open process by setting the display style to block\r\n  targetModal.style.display = 'block'\r\n\r\n  // then set the event listeners for the options\r\n  targetModal.addEventListener('transitionend', toggleOnEventListenersToCloseModal)\r\n\r\n  // the dom needs a moment to update after setting display styles, so set\r\n  // a minimal timeout function before updating the attribute we are\r\n  // checking for in our styles\r\n  setTimeout(() => {\r\n    targetModal.setAttribute('data-modal-open', '')\r\n  }, 1)\r\n\r\n  // now we set up a function that returns after a set amount of time\r\n  const modalStatus = await modalTransitionTimer(options)\r\n  console.log(modalStatus)\r\n\r\n  // after the set amount of time call the show-modal function\r\n  // for accessability\r\n  targetModal.showModal()\r\n}\r\n\r\nfunction toggleOnEventListenersToCloseModal() {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n\r\n  console.log('modal opened')\r\n  targetModal.removeEventListener('transitionend', toggleOnEventListenersToCloseModal)\r\n  toggleEventListenersToCloseModal(true)\r\n}\r\n\r\nasync function closeModal() {\r\n  if (!targetModalId || !targetModal) {\r\n    throw new Error(`no modal target ${arguments.callee.name}`)\r\n  }\r\n  if(modalClosing){return}\r\n  modalClosing = true\r\n\r\n  // remove the closing events for the modal since we are closing it now\r\n  toggleEventListenersToCloseModal(false)\r\n\r\n  // then start the close process\r\n  targetModal.addEventListener('transitionend', toggleOffEventListenersToCloseModal)\r\n  targetModal.removeAttribute('data-modal-open')\r\n\r\n  // now we set up a function that returns after a set amount of time\r\n  const modalStatus = await modalTransitionTimer(modalOptions)\r\n  console.log(modalStatus)\r\n}\r\n\r\nfunction toggleOffEventListenersToCloseModal() {\r\n  // remove the listener for the transition\r\n  targetModal.removeEventListener('transitionend', toggleOffEventListenersToCloseModal)\r\n  targetModal.style = ''\r\n  toggleEventListenersToCloseModal(false)\r\n  toggleOptionsAndAttributes(false)\r\n  targetModal.close()\r\n  console.log('modal closed')\r\n  modalClosing = false\r\n}\r\n\r\nasync function modalTransitionTimer(options) {\r\n  const timeOut = options ? options.transitionTime + 50 : modalOptions.transitionTime + 50\r\n  return new Promise(resolve => {\r\n    setTimeout(() => {\r\n      resolve(true)\r\n    }, timeOut)\r\n  })\r\n}\r\n\r\nclass Modals {\r\n  async open(id = '', options = {}) {\r\n    // debugger\r\n    try {\r\n      // user must provide an id to open a modal\r\n      if (id === '') {\r\n        throw new Error('No id provided')\r\n      }\r\n\r\n      // if a modal is opening return to prevent double inputs\r\n      if (modalOpening) {\r\n        return\r\n      }\r\n      modalOpening = true\r\n\r\n      // if a modal is already open, then close the open one first\r\n      if (targetModalId !== null) {\r\n        await this.close(targetModalId)\r\n      }\r\n\r\n      // set up the environment to work in\r\n      setModalValuesAndEnvironment(id, options)\r\n\r\n      // turn off the scroll of the page\r\n      toggleScroll(true)\r\n\r\n      // then run the open logic\r\n      await openModal(id, options)\r\n\r\n      // set the opening check back to false\r\n      modalOpening = false\r\n    } catch (error) {\r\n        logger.error(error)\r\n    }\r\n  }\r\n\r\n  async close() {\r\n    try {\r\n      // there must be an open modal to close a modal\r\n      if (targetModalId === null) {\r\n        throw new Error('no modal to close')\r\n      }\r\n\r\n      // if the modal is closing, then return to prevent double inputs\r\n      if (modalClosing) {\r\n        return\r\n      }\r\n\r\n      modalClosing = true\r\n\r\n      // then run the close logic\r\n      await closeModal()\r\n\r\n      // if there is a modal opening, don't restore\r\n      // scroll capability\r\n      if (!modalOpening) {\r\n        toggleScroll(false)\r\n      }\r\n\r\n      // clear the environment\r\n      resetModalValuesAndEnvironment()\r\n\r\n      // Set the check back to false\r\n      modalClosing = false\r\n    } catch (error) {\r\n      if (vars.dev) {\r\n        logger.error(error)\r\n      } else {\r\n        console.log(error)\r\n      }\r\n    }\r\n  }\r\n\r\n  async toggle(id = '', options = {}) {\r\n    try {\r\n      if (id === '') {\r\n        // if no id provided, default to close\r\n        await this.close()\r\n        return\r\n      }\r\n\r\n      if (targetModalId === null || targetModalId !== id) {\r\n        // open a modal if no modal is open or if the id provided is not the\r\n        // id of the currently open modal\r\n        await this.open(id, options)\r\n      } else {\r\n        // close the modal if the open modal is equal to the id provided\r\n        await this.close()\r\n      }\r\n    } catch (error) {\r\n      if (vars.dev) {\r\n        logger.error(error)\r\n      } else {\r\n        console.log(error)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const modal = new Modals()\r\n"],"names":["targetModalId","targetModal","modalOptions","modalClosing","modalOpening","setFocus","Error","arguments","callee","name","autofocus","Array","prototype","forEach","call","querySelectorAll","logger","log","firstChild","setAttribute","awaitEscKeyCloseModal","e","key","keyCode","closeModal","awaitOutClickCloseModal","checkVisibility","rect","getBoundingClientRect","x","left","width","y","top","height","awaitOutTouchStartToCloseModal","changedTouches","clientX","clientY","window","scrollX","addEventListener","awaitOutTouchEndToCloseModal","scrollY","removeEventListener","getScrollBarWidth","el","document","createElement","style","cssText","body","append","offsetWidth","clientWidth","remove","toggleScroll","toggle","scrollBarWidth","classList","add","paddingRight","toggleEventListenersToCloseModal","preventDefault","toggleOptionsAndAttributes","options","Modal","centered","static","scrollable","animation","removeAttribute","setModalValuesAndEnvironment","id","getElementById","resetModalValuesAndEnvironment","openModal","display","toggleOnEventListenersToCloseModal","setTimeout","modalStatus","modalTransitionTimer","console","showModal","toggleOffEventListenersToCloseModal","close","timeOut","transitionTime","Promise","resolve","Modals","open","error","vars","dev","modal"],"mappings":"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"}